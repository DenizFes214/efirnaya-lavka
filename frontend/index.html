<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üåø –≠—Ñ–∏—Ä–Ω–∞—è –õ–∞–≤–∫–∞ ‚ú®</title>
  <link rel="icon" href="/static/icons/witch_broom.png">
  <link rel="stylesheet" href="/static/css/tma-styles.css">
  <style>
    .image-viewer-nav{position:absolute; top:50%; transform:translateY(-50%); color:#fff; font-size:30px; cursor:pointer; background:rgba(0,0,0,0.5); border-radius:50%; width:50px; height:50px; display:flex; justify-content:center; align-items:center;}
    .image-viewer-prev{left:20px;}
    .image-viewer-next{right:20px;}
    .delivery-option{margin-bottom:15px; padding:10px; border:1px solid #ddd; border-radius:8px;}
    .delivery-fields{margin-top:10px; padding:10px; background:#f9f9f9; border-radius:6px;}
  </style>
</head>
<body class="tg-viewport">
  
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ª–∞–≤–∫–∏ -->
  <header class="shop-header">
    <h1>üåø –≠—Ñ–∏—Ä–Ω–∞—è –õ–∞–≤–∫–∞ ‚ú®</h1>
    <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –¥—Ä–µ–≤–Ω–µ–π –º—É–¥—Ä–æ—Å—Ç–∏</p>
  </header>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <main id="app" class="container">
    
    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loadingScreen" class="magical-loader">
      <span class="spinner">üîÆ</span>
      <p>–ó–∞–∂–∏–≥–∞–µ–º —Å–≤–µ—á–∏...</p>
    </div>

    <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ -->
    <div id="homeScreen" style="display:none;">
      <div class="magical-container">
        <h2>üóùÔ∏è –¢–∞–π–Ω—ã–µ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
        <div class="categories-grid" id="categoriesGrid">
          <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –∫–∞—Ç–∞–ª–æ–≥–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
    <div id="catalogScreen" style="display:none;">
      <div class="magical-container">
        <div class="screen-header">
          <button class="btn-back" onclick="etherealShop.showScreen('home')">‚Üê –ù–∞–∑–∞–¥</button>
          <h2 id="categoryTitle">–ö–∞—Ç–∞–ª–æ–≥</h2>
        </div>
        <div class="product-grid" id="productGrid">
          <!-- –¢–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Ç–æ–≤–∞—Ä–∞ -->
    <div id="productScreen" style="display:none;">
      <div class="magical-container" id="productDetails">
        <!-- –î–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –∫–æ—Ä–∑–∏–Ω—ã -->
    <div id="cartScreen" style="display:none;">
      <div class="magical-container">
        <div class="screen-header">
          <button class="btn-back" onclick="etherealShop.showScreen('home')">‚Üê –ù–∞–∑–∞–¥</button>
          <h2>üõí –í–æ–ª—à–µ–±–Ω–∞—è –ö–æ—Ä–∑–∏–Ω–∞</h2>
        </div>
        <div id="cartItems">
          <!-- –¢–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ -->
        </div>
        <div id="cartSummary" style="display:none;">
          <!-- –ò—Ç–æ–≥–∏ –∑–∞–∫–∞–∑–∞ -->
        </div>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –∑–∞–∫–∞–∑–æ–≤ -->
    <div id="ordersScreen" style="display:none;">
      <div class="magical-container">
        <div class="screen-header">
          <button class="btn-back" onclick="etherealShop.showScreen('home')">‚Üê –ù–∞–∑–∞–¥</button>
          <h2>üìú –ò—Å—Ç–æ—Ä–∏—è –ó–∞–∫–∞–∑–æ–≤</h2>
        </div>
        <div id="ordersList">
          <!-- –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ -->
        </div>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –ø—Ä–æ—Ñ–∏–ª—è -->
    <div id="profileScreen" style="display:none;">
      <div class="magical-container">
        <div class="screen-header">
          <button class="btn-back" onclick="etherealShop.showScreen('home')">‚Üê –ù–∞–∑–∞–¥</button>
          <h2>üë§ –ü—Ä–æ—Ñ–∏–ª—å –ü—É—Ç–Ω–∏–∫–∞</h2>
        </div>
        <div id="profileContent">
          <div class="profile-section">
            <h3>‚ú® –õ–∏—á–Ω—ã–µ –î–∞–Ω–Ω—ã–µ</h3>
            <div id="userInfo" class="user-info">
              <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
          </div>
          
          <div class="profile-section">
            <h3>üõí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ö–æ—Ä–∑–∏–Ω—ã</h3>
            <div class="settings-group">
              <label class="setting-item">
                <input type="checkbox" id="hideDeliveryFields">
                <span>–°–∫—Ä—ã—Ç—å –ø–æ–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π</span>
              </label>
              <label class="setting-item">
                <input type="checkbox" id="saveLastCategory">
                <span>–ó–∞–ø–æ–º–∏–Ω–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –ø–æ—Å–µ—â–µ–Ω–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</span>
              </label>
            </div>
          </div>
          
          <div class="profile-section">
            <h3>üìú –ò—Å—Ç–æ—Ä–∏—è –ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</h3>
            <div id="recentViewed" class="recent-items">
              <!-- –ù–µ–¥–∞–≤–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã -->
            </div>
          </div>
        </div>
      </div>
    </div>

  </main>

  <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
  <nav class="bottom-nav">
    <div class="nav-container">
      <a href="#" class="nav-item active" onclick="showScreen('home')" id="nav-home">
        <span class="nav-icon">üè†</span>
        <span class="nav-label">–ì–ª–∞–≤–Ω–∞—è</span>
      </a>
      <a href="#" class="nav-item" onclick="showScreen('catalog')" id="nav-catalog">
        <span class="nav-icon">üìö</span>
        <span class="nav-label">–ö–∞—Ç–∞–ª–æ–≥</span>
      </a>
      <a href="#" class="nav-item" onclick="showScreen('cart')" id="nav-cart">
        <span class="nav-icon">üõí</span>
        <span class="nav-label">–ö–æ—Ä–∑–∏–Ω–∞</span>
        <span class="cart-count" id="cartCount" style="display:none;">0</span>
      </a>
      <a href="#" class="nav-item" onclick="showScreen('orders')" id="nav-orders">
        <span class="nav-icon">üìú</span>
        <span class="nav-label">–ó–∞–∫–∞–∑—ã</span>
      </a>
      <a href="#" class="nav-item" onclick="showScreen('profile')" id="nav-profile">
        <span class="nav-icon">üë§</span>
        <span class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</span>
      </a>
    </div>
  </nav>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
  <div id="imageViewer" class="image-viewer">
    <span class="image-viewer-close" onclick="closeImageViewer()">√ó</span>
    <span class="image-viewer-nav image-viewer-prev" onclick="changeImage(-1)">‚Äπ</span>
    <img id="viewerImage" src="" alt="">
    <span class="image-viewer-nav image-viewer-next" onclick="changeImage(1)">‚Ä∫</span>
  </div>

  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
  <script src="/static/js/tma-init.js"></script>
  <script src="/static/js/magical-app.js"></script>
  <script>
    console.log('üåü HTML –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é...');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    function checkDependencies() {
      if (typeof EtherealShop !== 'undefined' && 
          typeof TelegramWebAppIntegration !== 'undefined') {
        console.log('‚úÖ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
        return true;
      }
      console.log('‚è≥ –û–∂–∏–¥–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...');
      console.log('EtherealShop:', typeof EtherealShop);
      console.log('TelegramWebAppIntegration:', typeof TelegramWebAppIntegration);
      return false;
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
    document.addEventListener('DOMContentLoaded', () => {
      console.log('üîÆ DOM –≥–æ—Ç–æ–≤, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≠—Ñ–∏—Ä–Ω—É—é –õ–∞–≤–∫—É...');
      
      // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
      const initApp = () => {
        if (checkDependencies()) {
          console.log('üöÄ –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä EtherealShop...');
          window.etherealShop = new EtherealShop();
        } else {
          setTimeout(initApp, 100);
        }
      };
      
      initApp();
    });

    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è Telegram WebApp
    if (window.Telegram?.WebApp) {
      console.log('üì± Telegram WebApp –Ω–∞–π–¥–µ–Ω');
      window.Telegram.WebApp.ready();
    } else {
      console.log('üì± Telegram WebApp –Ω–µ –Ω–∞–π–¥–µ–Ω, —Ä–∞–±–æ—Ç–∞–µ–º –≤ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ');
    }
  </script>
</body>
</html>
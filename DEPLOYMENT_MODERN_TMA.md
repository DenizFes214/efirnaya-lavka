# üöÄ –î–µ–ø–ª–æ–π–º–µ–Ω—Ç Telegram MiniApp - –≠—Ñ–∏—Ä–Ω–∞—è –õ–∞–≤–∫–∞

## üì¶ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç—É

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
npm install @tma.js/sdk@^2.6.0 @tma.js/init-data-node@^2.0.3

# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
npm uninstall @telegram-apps/sdk @telegram-apps/init-data-node telegraf

# –ü—Ä–æ–≤–µ—Ä–∫–∞
npm ls
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
npm audit fix

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
npm audit fix --force

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
npm audit
```

### 3. –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
```bash
git add .
git commit -m "feat: Update to @tma.js/sdk 2.6.0 and modern TMA setup"
git push origin main
```

## üõ† –§–∞–π–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `package.json` - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `frontend/static/js/tma-init-modern.js` - –Ω–æ–≤—ã–π SDK
- `frontend/index.html` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
- `TELEGRAM_MINIAPP_GUIDE.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### üìã –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

#### 1. **package.json**
```json
{
  "dependencies": {
    "@tma.js/sdk": "^2.6.0",
    "@tma.js/init-data-node": "^2.0.3",
    "better-sqlite3": "^11.3.0",
    "cors": "^2.8.5", 
    "express": "^4.21.0",
    "multer": "^2.0.0-rc.4",
    "node-telegram-bot-api": "^0.66.0"
  }
}
```

#### 2. **–ù–æ–≤—ã–π TMA SDK (tma-init-modern.js)**
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π @tma.js/sdk 2.6.0
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MiniApp
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ viewport, —Ç–µ–º–æ–π, –∫–Ω–æ–ø–∫–∞–º–∏
- ‚úÖ –¢–∞–∫—Ç–∏–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
- ‚úÖ –û–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã
- ‚úÖ Fallback —Ä–µ–∂–∏–º –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

#### 3. **HTML –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**
```html
<!-- –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<!-- –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–± -->
<script type="module" src="/static/js/tma-init-modern.js"></script>
```

## üéØ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–æ–≤–æ–≥–æ SDK

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- **–ê–≤—Ç–æ-–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- **–£–º–Ω–∞—è –∫–æ—Ä–∑–∏–Ω–∞** —Å –æ–±–ª–∞—á–Ω—ã–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- **–¢–∞–∫—Ç–∏–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å** –¥–ª—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
- **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏** (–≥–ª–∞–≤–Ω–∞—è/–Ω–∞–∑–∞–¥) 
- **–¢–µ–º–∞ Telegram** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è
- **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

### üì± API –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
```javascript
// –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç TMA
window.TMA = {
  isReady: () => boolean,
  getUser: () => User | null,
  addToCart: (product) => void,
  removeFromCart: (productId) => void,
  triggerHaptic: (type) => void,
  showMainButton: (text, color) => void,
  hideMainButton: () => void,
  showBackButton: () => void,
  hideBackButton: () => void,
  close: () => void
}

// –°–æ–±—ã—Ç–∏—è
window.addEventListener('tmaReady', (event) => {
  const { user, fallback } = event.detail;
  console.log('TMA –≥–æ—Ç–æ–≤:', user);
});
```

## üìä –°—Ç–∞—Ç—É—Å –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç–∞

### ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ:
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ package.json —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- [x] –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ TMA initialization —Ñ–∞–π–ª–∞
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ HTML –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ES6 modules
- [x] –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- [x] –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∫–æ–º–º–∏—Ç—É –∏ –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç—É

### üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. **–î–µ–ø–ª–æ–π–º–µ–Ω—Ç –Ω–∞ AMVERA**
   ```bash
   git push amvera main
   ```

2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Telegram**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ SDK
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–∫—Ç–∏–ª—å–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã –∏ –æ–±–ª–∞—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞**
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ WebApp URL
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–º–∞–Ω–¥ –∏ –º–µ–Ω—é
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ production

## üö® –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ issues:
1. **–£—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** - 6 vulnerabilities (4 moderate, 2 critical)
   - –°–≤—è–∑–∞–Ω—ã —Å `node-telegram-bot-api` –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
   - –†–µ—à–µ–Ω–∏–µ: `npm audit fix --force` (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)

2. **ES6 modules –≤ –±—Ä–∞—É–∑–µ—Ä–µ**
   - –¢—Ä–µ–±—É–µ—Ç—Å—è `type="module"` –≤ script tag
   - Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è

3. **CDN vs local modules**
   - –ù–æ–≤—ã–π –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ES6 –∏–º–ø–æ—Ä—Ç—ã
   - –ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è bundler –¥–ª—è production

### üîß –†–µ—à–µ–Ω–∏—è:
```bash
# –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏
npm install --save-dev vite
# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CDN –≤–µ—Ä—Å–∏—é @tma.js/sdk

# –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é
npm install node-telegram-bot-api@latest --force
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### üéØ KPI –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
- ‚úÖ –í—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ SDK
- ‚úÖ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
- ‚úÖ –†–∞–±–æ—Ç–∞ –∫–æ—Ä–∑–∏–Ω—ã –∏ –æ–±–ª–∞—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- ‚úÖ –¢–∞–∫—Ç–∏–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
- ‚úÖ –ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏

### üìä –õ–æ–≥–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –±—É–¥—É—Ç –≤–∏–¥–Ω—ã:
console.log('üåø –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≠—Ñ–∏—Ä–Ω–æ–π –õ–∞–≤–∫–∏...');
console.log('‚úÖ Telegram SDK –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');  
console.log('üì± Viewport –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
console.log('üé® –¢–µ–º–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞:', theme);
console.log('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', user.firstName);
console.log('üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞:', result.user?.first_name);
console.log('üõí –ö–æ—Ä–∑–∏–Ω–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ –æ–±–ª–∞–∫–∞:', cart.length, '—Ç–æ–≤–∞—Ä–æ–≤');
console.log('üéâ –≠—Ñ–∏—Ä–Ω–∞—è –õ–∞–≤–∫–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!');
```

---

**üöÄ –ì–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç—É!**

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã. –ú–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å:
```bash
git push amvera main
```

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø–æ –∞–¥—Ä–µ—Å—É:
**https://efirnayalavka-aleksei57.amvera.io**